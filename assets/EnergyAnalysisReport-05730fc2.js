import{i as E}from"./index-6433f102.js";import{_ as ne,z as le,r as V,f as Z,k as oe,g as p,o as C,c as q,a as u,h as e,i as a,p as F,N as I,M as re,E as P,P as se,F as G,q as J,j as T,t as W}from"./index-45cd1a9a.js";const ie={name:"EnergyAnalysisReport",components:{ArrowDown:le},setup(){const M=V(null),n=V(null),A=V(null),o=V(null);let x=null,D=null,w=null,y=null;const t=Z({dateRange:[new Date(new Date().setDate(new Date().getDate()-30)),new Date],energyType:"electricity",dimension:"day",compareCycle:"none",zoneId:[],displayType:"line"}),c=V(""),k=V([{id:1,name:"月度能源趋势分析",config:{energyType:"electricity",dimension:"month"}},{id:2,name:"用电高峰时段分析",config:{energyType:"electricity",dimension:"hour"}},{id:3,name:"区域能耗对比",config:{energyType:"electricity",dimension:"day",zoneId:["a","b","c"]}}]),R=Z([{id:"a",name:"A栋"},{id:"b",name:"B栋"},{id:"c",name:"C栋"},{id:"d",name:"D栋"},{id:"parking",name:"停车场"}]),_=l=>{const r={electricity:{name:"电力",unit:"kWh",color:"#1890ff"},water:{name:"水",unit:"m³",color:"#13c2c2"},gas:{name:"燃气",unit:"m³",color:"#fa8c16"},heat:{name:"热力",unit:"GJ",color:"#f5222d"}};return r[l]||r.electricity},S=()=>c.value.trim().length>0,v=()=>{re(()=>{L()})},B=()=>{t.dateRange=[new Date(new Date().setDate(new Date().getDate()-30)),new Date],t.energyType="electricity",t.dimension="day",t.compareCycle="none",t.zoneId=[],t.displayType="line",v()},U=()=>{if(!c.value.trim()){P.warning("请输入报表名称");return}const l={id:Date.now(),name:c.value.trim(),config:{...t}};k.value.push(l),P.success("模板保存成功")},H=l=>{Object.assign(t,l.config),c.value=l.name,v()},N=()=>{se.confirm("确定要导出当前报表吗？","导出报表",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{setTimeout(()=>{P.success("报表导出成功")},1e3)}).catch(()=>{})},L=()=>{O(),M.value&&(x=E(M.value),d()),t.compareCycle!=="none"&&n.value&&(D=E(n.value),K()),t.zoneId&&t.zoneId.length>0&&A.value&&(w=E(A.value),Q()),t.energyType==="electricity"&&t.dimension==="hour"&&o.value&&(y=E(o.value),X())},O=()=>{x&&x.dispose(),D&&D.dispose(),w&&w.dispose(),y&&y.dispose()},d=()=>{const l=_(t.energyType),r=Y(),s=[{name:l.name,type:t.displayType,data:r.values,itemStyle:{color:l.color},smooth:t.displayType==="line"}],m={title:{text:`${l.name}趋势分析`,left:"center"},tooltip:{trigger:"axis",formatter:function(i){const f=i[0];return`${f.name}<br/>${f.seriesName}: ${f.value} ${l.unit}`}},xAxis:{type:"category",data:r.labels,axisLabel:{rotate:45}},yAxis:{type:"value",name:l.unit},series:s};x.setOption(m)},K=()=>{const l=_(t.energyType),r=Y(),s=$(),m=[{name:"当前期",type:t.displayType,data:r.values,itemStyle:{color:l.color},smooth:t.displayType==="line"},{name:t.compareCycle==="monthly"?"上期":"同期",type:t.displayType,data:s.values,itemStyle:{color:"#91d5ff"},smooth:t.displayType==="line"}],i={title:{text:`${l.name}${t.compareCycle==="monthly"?"环比":"同比"}分析`,left:"center"},tooltip:{trigger:"axis",formatter:function(f){let b=`${f[0].name}<br/>`;return f.forEach(g=>{b+=`${g.seriesName}: ${g.value} ${l.unit}<br/>`}),b}},legend:{data:["当前期",t.compareCycle==="monthly"?"上期":"同期"],top:30},xAxis:{type:"category",data:r.labels,axisLabel:{rotate:45}},yAxis:{type:"value",name:l.unit},series:m};D.setOption(i)},Q=()=>{const l=_(t.energyType),r=ee(),s=[{name:l.name,type:t.displayType,data:r.values,itemStyle:{color:l.color},smooth:t.displayType==="line"}],m={title:{text:`区域${l.name}对比`,left:"center"},tooltip:{trigger:"axis",formatter:function(i){const f=i[0];return`${f.name}<br/>${f.seriesName}: ${f.value} ${l.unit}`}},xAxis:{type:"category",data:r.labels},yAxis:{type:"value",name:l.unit},series:s};w.setOption(m)},X=()=>{const l=_("electricity"),r=te(),s={title:{text:"用电高峰时段分析",left:"center"},tooltip:{trigger:"axis",formatter:function(m){return`${m[0].name}时<br/>用电量: ${m[0].value} ${l.unit}`}},xAxis:{type:"category",data:r.labels},yAxis:{type:"value",name:l.unit},series:[{name:"用电量",type:"bar",data:r.values,itemStyle:{color:function(m){const i=parseInt(m.name);return i>=9&&i<=18?"#ff4d4f":i>=6&&i<9||i>18&&i<=22?"#faad14":"#52c41a"}}}]};y.setOption(s)},Y=()=>{const l=[],r=[],s=t.dateRange[0],m=t.dateRange[1],i=Math.ceil((m-s)/(1e3*60*60*24));let f=i;t.dimension==="week"?f=Math.ceil(i/7):t.dimension==="month"&&(f=Math.ceil(i/30));for(let b=0;b<f;b++){const g=new Date(s);let z="",h=0;switch(t.dimension){case"day":g.setDate(g.getDate()+b),z=g.toLocaleDateString("zh-CN"),h=1e4;break;case"week":g.setDate(g.getDate()+b*7);const j=new Date(g);j.setDate(j.getDate()+6),z=`第${Math.ceil((g.getDate()+g.getDay())/7)}周`,h=7e4;break;case"month":g.setMonth(g.getMonth()+b),z=`${g.getMonth()+1}月`,h=3e5;break;case"hour":z=b,h=5e3;break}switch(t.energyType){case"electricity":h=h;break;case"water":h=h/100;break;case"gas":h=h/200;break;case"heat":h=h/5e3;break}l.push(z),r.push(h*(.8+Math.random()*.4))}return{labels:l,values:r}},$=()=>{const l=Y(),r=l.values.map(s=>s*(.9+Math.random()*.2));return{labels:l.labels,values:r}},ee=()=>{const l=[],r=[];return t.zoneId.forEach(s=>{const m=R.find(i=>i.id===s);if(m){l.push(m.name);let i=5e4;switch(t.energyType){case"electricity":i=5e4;break;case"water":i=500;break;case"gas":i=250;break;case"heat":i=10;break}r.push(i*(.7+Math.random()*.6))}}),{labels:l,values:r}},te=()=>{const l=[],r=[];for(let s=0;s<24;s++){l.push(s);let m=0;s>=9&&s<=18?m=8e3:s>=6&&s<9||s>18&&s<=22?m=4e3:m=1e3,r.push(m*(.8+Math.random()*.4))}return{labels:l,values:r}},ae=()=>{x&&x.resize(),D&&D.resize(),w&&w.resize(),y&&y.resize()};return oe(()=>{window.addEventListener("resize",ae),v()}),{filterForm:t,reportName:c,reportTemplates:k,zones:R,trendChartRef:M,compareChartRef:n,zoneCompareChartRef:A,peakHourChartRef:o,hasReportName:S,queryData:v,resetFilter:B,saveReportTemplate:U,handleTemplateSelect:H,exportReport:N}}},de={class:"energy-analysis-report"},ce={class:"report-info"},me={class:"analysis-content"},ue={class:"chart-container"},pe={ref:"trendChartRef",style:{width:"100%",height:"400px"}},ye={class:"card-header"},fe={class:"chart-container"},ge={ref:"compareChartRef",style:{width:"100%",height:"400px"}},he={class:"chart-container"},_e={ref:"zoneCompareChartRef",style:{width:"100%",height:"400px"}},ve={class:"chart-container"},be={ref:"peakHourChartRef",style:{width:"100%",height:"400px"}};function Ce(M,n,A,o,x,D){const w=p("el-date-picker"),y=p("el-form-item"),t=p("el-col"),c=p("el-option"),k=p("el-select"),R=p("el-row"),_=p("el-button"),S=p("el-form"),v=p("el-card"),B=p("el-input"),U=p("ArrowDown"),H=p("el-icon"),N=p("el-dropdown-item"),L=p("el-dropdown-menu"),O=p("el-dropdown");return C(),q("div",de,[n[16]||(n[16]=u("div",{class:"page-header"},[u("h1",null,"能耗分析报表")],-1)),e(v,{class:"filter-card"},{default:a(()=>[e(S,{model:o.filterForm,"label-width":"100px"},{default:a(()=>[e(R,{gutter:20},{default:a(()=>[e(t,{span:6},{default:a(()=>[e(y,{label:"时间范围"},{default:a(()=>[e(w,{modelValue:o.filterForm.dateRange,"onUpdate:modelValue":n[0]||(n[0]=d=>o.filterForm.dateRange=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(t,{span:6},{default:a(()=>[e(y,{label:"能源类型"},{default:a(()=>[e(k,{modelValue:o.filterForm.energyType,"onUpdate:modelValue":n[1]||(n[1]=d=>o.filterForm.energyType=d),placeholder:"选择能源类型"},{default:a(()=>[e(c,{label:"电力",value:"electricity"}),e(c,{label:"水",value:"water"}),e(c,{label:"燃气",value:"gas"}),e(c,{label:"热力",value:"heat"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:6},{default:a(()=>[e(y,{label:"分析维度"},{default:a(()=>[e(k,{modelValue:o.filterForm.dimension,"onUpdate:modelValue":n[2]||(n[2]=d=>o.filterForm.dimension=d),placeholder:"选择分析维度"},{default:a(()=>[e(c,{label:"按日",value:"day"}),e(c,{label:"按周",value:"week"}),e(c,{label:"按月",value:"month"}),e(c,{label:"按时段",value:"hour"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:6},{default:a(()=>[e(y,{label:"对比周期"},{default:a(()=>[e(k,{modelValue:o.filterForm.compareCycle,"onUpdate:modelValue":n[3]||(n[3]=d=>o.filterForm.compareCycle=d),placeholder:"选择对比周期"},{default:a(()=>[e(c,{label:"不对比",value:"none"}),e(c,{label:"环比",value:"monthly"}),e(c,{label:"同比",value:"yearly"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(R,{gutter:20,style:{"margin-top":"10px"}},{default:a(()=>[e(t,{span:6},{default:a(()=>[e(y,{label:"区域/楼栋"},{default:a(()=>[e(k,{modelValue:o.filterForm.zoneId,"onUpdate:modelValue":n[4]||(n[4]=d=>o.filterForm.zoneId=d),placeholder:"选择区域",multiple:"","collapse-tags":""},{default:a(()=>[(C(!0),q(G,null,J(o.zones,d=>(C(),F(c,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:6},{default:a(()=>[e(y,{label:"显示方式"},{default:a(()=>[e(k,{modelValue:o.filterForm.displayType,"onUpdate:modelValue":n[5]||(n[5]=d=>o.filterForm.displayType=d),placeholder:"选择显示方式"},{default:a(()=>[e(c,{label:"折线图",value:"line"}),e(c,{label:"柱状图",value:"bar"}),e(c,{label:"饼图",value:"pie"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(t,{span:12,style:{"text-align":"right"}},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{type:"primary",onClick:o.queryData},{default:a(()=>[...n[7]||(n[7]=[T("查询",-1)])]),_:1},8,["onClick"]),e(_,{onClick:o.resetFilter},{default:a(()=>[...n[8]||(n[8]=[T("重置",-1)])]),_:1},8,["onClick"]),e(_,{type:"primary",onClick:o.saveReportTemplate,disabled:!o.hasReportName},{default:a(()=>[...n[9]||(n[9]=[T("保存模板",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),u("div",ce,[e(B,{modelValue:o.reportName,"onUpdate:modelValue":n[6]||(n[6]=d=>o.reportName=d),placeholder:"输入报表名称",clearable:"",style:{width:"300px","margin-right":"10px"}},null,8,["modelValue"]),e(O,{onCommand:o.handleTemplateSelect},{dropdown:a(()=>[e(L,null,{default:a(()=>[(C(!0),q(G,null,J(o.reportTemplates,d=>(C(),F(N,{key:d.id,command:d},{default:a(()=>[T(W(d.name),1)]),_:2},1032,["command"]))),128)),o.reportTemplates.length===0?(C(),F(N,{key:0,divided:""},{default:a(()=>[...n[11]||(n[11]=[T("暂无保存的模板",-1)])]),_:1})):I("",!0)]),_:1})]),default:a(()=>[e(_,{type:"default"},{default:a(()=>[n[10]||(n[10]=T(" 加载模板 ",-1)),e(H,{class:"el-icon--right"},{default:a(()=>[e(U)]),_:1})]),_:1})]),_:1},8,["onCommand"]),e(_,{type:"success",onClick:o.exportReport},{default:a(()=>[...n[12]||(n[12]=[T("导出报表",-1)])]),_:1},8,["onClick"])]),u("div",me,[e(v,{class:"analysis-card"},{header:a(()=>[...n[13]||(n[13]=[u("div",{class:"card-header"},[u("span",null,"趋势分析")],-1)])]),default:a(()=>[u("div",ue,[u("div",pe,null,512)])]),_:1}),o.filterForm.compareCycle!=="none"?(C(),F(v,{key:0,class:"analysis-card"},{header:a(()=>[u("div",ye,[u("span",null,W(o.filterForm.compareCycle==="monthly"?"环比":"同比")+"对比分析",1)])]),default:a(()=>[u("div",fe,[u("div",ge,null,512)])]),_:1})):I("",!0),o.filterForm.zoneId&&o.filterForm.zoneId.length>0?(C(),F(v,{key:1,class:"analysis-card"},{header:a(()=>[...n[14]||(n[14]=[u("div",{class:"card-header"},[u("span",null,"区域对比分析")],-1)])]),default:a(()=>[u("div",he,[u("div",_e,null,512)])]),_:1})):I("",!0),o.filterForm.energyType==="electricity"&&o.filterForm.dimension==="hour"?(C(),F(v,{key:2,class:"analysis-card"},{header:a(()=>[...n[15]||(n[15]=[u("div",{class:"card-header"},[u("span",null,"用电高峰时段分析")],-1)])]),default:a(()=>[u("div",ve,[u("div",be,null,512)])]),_:1})):I("",!0)])])}const xe=ne(ie,[["render",Ce],["__scopeId","data-v-8515c9f9"]]);export{xe as default};
