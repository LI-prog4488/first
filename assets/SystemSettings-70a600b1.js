import{_ as re,a1 as ue,a2 as me,Q as ge,a3 as ce,r as w,f as L,K as Z,k as pe,g as d,O as be,o as V,c as O,a as m,h as e,i as n,E as S,P as $,j as c,t as F,F as fe,q as he,p as K,w as ee,N as le}from"./index-45cd1a9a.js";const we={name:"SystemSettings",components:{DocumentAdd:ue,RefreshLeft:me,Plus:ge,Search:ce},setup(){const X=w("basic"),l=w("operation"),I=w(!1),t=w(!1),P=w(!1),k=w(!1),T=w(!1),h=w(null),p=w(null),U=w(null),i=L({energyUnit:"kWh",waterUnit:"m³",gasUnit:"m³",heatUnit:"GJ",refreshRate:"30",exportCycle:"weekly",dataRetentionPeriod:365,theme:"default"}),v=L({electricityThreshold:500,waterThreshold:50,gasThreshold:30,heatThreshold:10,deviceOfflineDuration:30,dataFluctuationThreshold:20}),u=L({roleId:""}),b=w([]),g=L({name:"",description:"",status:!0}),z={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"角色名称长度应为2-20个字符",trigger:"blur"}],description:[{max:200,message:"角色描述长度不能超过200个字符",trigger:"blur"}]},x=w([]),D=w([]),f=L({type:"",username:"",dateRange:null}),E=L({current:1,size:10}),r=w([]),_=L({username:"",status:"",dateRange:null}),A=L({current:1,size:10}),W=Z(()=>D.value.filter(o=>{const s=!f.type||o.type===f.type,y=!f.username||o.username.toLowerCase().includes(f.username.toLowerCase()),Y=!f.dateRange||new Date(o.createdAt)>=new Date(f.dateRange[0])&&new Date(o.createdAt)<=new Date(f.dateRange[1]);return s&&y&&Y})),M=Z(()=>r.value.filter(o=>{const s=!_.username||o.username.toLowerCase().includes(_.username.toLowerCase()),y=!_.status||o.status===_.status,Y=!_.dateRange||new Date(o.createdAt)>=new Date(_.dateRange[0])&&new Date(o.createdAt)<=new Date(_.dateRange[1]);return s&&y&&Y})),C=o=>{if(!o)return"--";const s=new Date(o);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")} ${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}:${String(s.getSeconds()).padStart(2,"0")}`},B=o=>({login:"登录",logout:"登出",create:"创建",update:"更新",delete:"删除",query:"查询"})[o]||o,N=o=>({login:"primary",logout:"info",create:"success",update:"warning",delete:"danger",query:"info"})[o]||"info",H=()=>{I.value=!0,setTimeout(()=>{S.success("设置保存成功"),I.value=!1},1e3)},j=()=>{$.confirm("确定要重置所有设置吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Object.assign(i,{energyUnit:"kWh",waterUnit:"m³",gasUnit:"m³",heatUnit:"GJ",refreshRate:"30",exportCycle:"weekly",dataRetentionPeriod:365,theme:"default"}),Object.assign(v,{electricityThreshold:500,waterThreshold:50,gasThreshold:30,heatThreshold:10,deviceOfflineDuration:30,dataFluctuationThreshold:20}),S.success("设置已重置")}).catch(()=>{})},J=()=>{h.value=null,Object.assign(g,{name:"",description:"",status:!0}),T.value=!0},G=o=>{h.value=o.id,Object.assign(g,{name:o.name,description:o.description,status:o.status}),T.value=!0},Q=o=>{if(o.id==="1"||o.id==="2"||o.id==="3"){S.warning("系统内置角色不能删除");return}$.confirm(`确定要删除角色「${o.name}」吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"danger"}).then(()=>{const s=b.value.findIndex(y=>y.id===o.id);s!==-1&&(b.value.splice(s,1),S.success("角色删除成功"))}).catch(()=>{})},q=()=>{p.value&&p.value.validate(o=>{o&&(t.value=!0,setTimeout(()=>{if(h.value){const s=b.value.findIndex(y=>y.id===h.value);s!==-1&&(b.value[s]={...b.value[s],name:g.name,description:g.description,status:g.status},S.success("角色更新成功"))}else{const s={id:Date.now().toString(),name:g.name,description:g.description,status:g.status,createdAt:new Date().toISOString()};b.value.push(s),S.success("角色创建成功")}T.value=!1,t.value=!1},1e3))})},a=o=>{if(o.id==="1"||o.id==="2"||o.id==="3"){S.warning("系统内置角色状态不能修改"),o.status=!o.status;return}S.success(`角色「${o.name}」状态已${o.status?"启用":"禁用"}`)},R=o=>{const s=b.value.find(y=>y.id===o);return s?s.permissions||[]:[]},te=(o,s,y)=>{},ae=()=>{if(!u.roleId||!U.value){S.warning("请先选择角色");return}P.value=!0;const o=U.value.getCheckedKeys(),s=b.value.find(y=>y.id===u.roleId);s&&setTimeout(()=>{s.permissions=o,S.success("权限配置保存成功"),P.value=!1},1e3)},ne=()=>{k.value=!0,setTimeout(()=>{S.success(`搜索到 ${W.value.length} 条操作日志`),k.value=!1},800)},oe=()=>{Object.assign(f,{type:"",username:"",dateRange:null})},ie=()=>{k.value=!0,setTimeout(()=>{S.success(`搜索到 ${M.value.length} 条登录日志`),k.value=!1},800)},se=()=>{Object.assign(_,{username:"",status:"",dateRange:null})},de=()=>{b.value=[{id:"1",name:"超级管理员",description:"系统最高权限，可管理所有功能",status:!0,createdAt:new Date(Date.now()-30*24*60*60*1e3).toISOString(),permissions:["1","1-1","1-2","1-3","1-4","1-5","2","2-1","2-2","3","3-1","3-2","4","4-1","4-2","5","5-1","5-2","6","6-1","6-2","7","7-1","7-2","8","8-1","8-2","9","9-1","9-2","10","10-1","10-2","11","11-1","11-2","12","12-1","12-2","13","13-1","13-2"]},{id:"2",name:"企业管理员",description:"管理企业内部能源监测和设置",status:!0,createdAt:new Date(Date.now()-20*24*60*60*1e3).toISOString(),permissions:["1","1-1","1-2","1-3","2","2-1","2-2","3","3-1","3-2","4","4-1","4-2","9","9-1","9-2","13","13-1","13-2"]},{id:"3",name:"运维人员",description:"负责设备维护和故障处理",status:!0,createdAt:new Date(Date.now()-15*24*60*60*1e3).toISOString(),permissions:["1","1-1","1-2","2","2-1","5","5-1","5-2","6","6-1","6-2","9","9-1","9-2","10","10-1","10-2","13","13-1","13-2"]},{id:"4",name:"普通用户",description:"查看基础能耗数据",status:!0,createdAt:new Date(Date.now()-10*24*60*60*1e3).toISOString(),permissions:["1","1-1","2","2-1","3","3-1","13","13-1","13-2"]}],x.value=[{id:"1",label:"首页",children:[{id:"1-1",label:"仪表盘"},{id:"1-2",label:"实时监控"},{id:"1-3",label:"历史查询"},{id:"1-4",label:"能耗分析"},{id:"1-5",label:"异常预警"}]},{id:"2",label:"设备管理",children:[{id:"2-1",label:"设备列表"},{id:"2-2",label:"设备配置"}]},{id:"3",label:"区域管理",children:[{id:"3-1",label:"区域配置"},{id:"3-2",label:"区域权限"}]},{id:"4",label:"企业管理",children:[{id:"4-1",label:"企业列表"},{id:"4-2",label:"企业配额"}]},{id:"5",label:"故障处理",children:[{id:"5-1",label:"故障记录"},{id:"5-2",label:"处理流程"}]},{id:"6",label:"报表中心",children:[{id:"6-1",label:"报表生成"},{id:"6-2",label:"报表模板"}]},{id:"7",label:"系统设置",children:[{id:"7-1",label:"基础配置"},{id:"7-2",label:"阈值设置"}]},{id:"8",label:"权限管理",children:[{id:"8-1",label:"角色管理"},{id:"8-2",label:"权限配置"}]},{id:"9",label:"日志中心",children:[{id:"9-1",label:"操作日志"},{id:"9-2",label:"登录日志"}]},{id:"10",label:"帮助中心",children:[{id:"10-1",label:"使用手册"},{id:"10-2",label:"常见问题"}]},{id:"11",label:"个人中心",children:[{id:"11-1",label:"个人信息"},{id:"11-2",label:"密码修改"}]},{id:"12",label:"系统公告",children:[{id:"12-1",label:"公告列表"},{id:"12-2",label:"发布公告"}]},{id:"13",label:"系统工具",children:[{id:"13-1",label:"数据备份"},{id:"13-2",label:"系统升级"}]}],D.value=[{id:"1",username:"admin",type:"login",action:"用户登录系统",ip:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",createdAt:new Date(Date.now()-10*60*1e3).toISOString()},{id:"2",username:"admin",type:"update",action:"更新系统基础配置",ip:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",createdAt:new Date(Date.now()-8*60*1e3).toISOString()},{id:"3",username:"enterprise1",type:"query",action:"查询企业能耗数据",ip:"192.168.1.101",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/96.0.4664.110",createdAt:new Date(Date.now()-5*60*1e3).toISOString()},{id:"4",username:"admin",type:"create",action:"创建新角色：运维主管",ip:"192.168.1.100",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",createdAt:new Date(Date.now()-3*60*1e3).toISOString()},{id:"5",username:"operator1",type:"update",action:"更新设备状态",ip:"192.168.1.102",userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Firefox/95.0",createdAt:new Date(Date.now()-2*60*1e3).toISOString()}],r.value=[{id:"1",username:"admin",status:"success",message:"登录成功",ip:"192.168.1.100",location:"北京市",browser:"Chrome 96.0.4664.110",createdAt:new Date(Date.now()-10*60*1e3).toISOString()},{id:"2",username:"testuser",status:"failed",message:"密码错误",ip:"192.168.1.105",location:"上海市",browser:"Firefox 95.0",createdAt:new Date(Date.now()-15*60*1e3).toISOString()},{id:"3",username:"enterprise1",status:"success",message:"登录成功",ip:"192.168.1.101",location:"广州市",browser:"Safari 15.2",createdAt:new Date(Date.now()-20*60*1e3).toISOString()},{id:"4",username:"operator1",status:"success",message:"登录成功",ip:"192.168.1.102",location:"深圳市",browser:"Edge 96.0.1054.62",createdAt:new Date(Date.now()-30*60*1e3).toISOString()},{id:"5",username:"hacker",status:"failed",message:"尝试多次登录失败，已锁定",ip:"103.235.46.128",location:"未知位置",browser:"Unknown Browser",createdAt:new Date(Date.now()-45*60*1e3).toISOString()}]};return pe(()=>{de()}),{activeTab:X,activeLogTab:l,saving:I,savingRole:t,savingPermissions:P,loadingLogs:k,roleDialogVisible:T,editingRole:h,roleFormRef:p,menuTree:U,basicSettings:i,thresholdSettings:v,permissionsForm:u,roles:b,roleForm:g,roleRules:z,menuList:x,operationLogs:D,operationLogFilter:f,operationLogPage:E,loginLogs:r,loginLogFilter:_,loginLogPage:A,filteredOperationLogs:W,filteredLoginLogs:M,formatDateTime:C,getOperationTypeText:B,getOperationTypeTag:N,saveSettings:H,resetSettings:j,showAddRoleDialog:J,editRole:G,deleteRole:Q,saveRole:q,handleRoleStatusChange:a,getCheckedMenuIds:R,handleMenuCheckChange:te,saveRolePermissions:ae,searchOperationLogs:ne,resetOperationLogFilters:oe,searchLoginLogs:ie,resetLoginLogFilters:se}}},ve={class:"system-settings"},_e={class:"page-header"},ye={class:"header-actions"},Se={class:"permissions-section"},Ve={class:"section-header"},Le={key:1,class:"no-role-selected"},xe={class:"logs-section"},De={class:"logs-tabs"},ke={class:"logs-toolbar"},Te={key:0,class:"logs-pagination"},Ue={class:"logs-toolbar"},Ce={key:0,class:"logs-pagination"},Re={class:"dialog-footer"};function Fe(X,l,I,t,P,k){const T=d("Save"),h=d("el-icon"),p=d("el-button"),U=d("Refresh"),i=d("el-option"),v=d("el-select"),u=d("el-form-item"),b=d("el-col"),g=d("el-input-number"),z=d("el-row"),x=d("el-form"),D=d("el-card"),f=d("el-tab-pane"),E=d("Plus"),r=d("el-table-column"),_=d("el-switch"),A=d("el-table"),W=d("el-tree"),M=d("DocumentAdd"),C=d("el-input"),B=d("el-date-picker"),N=d("Search"),H=d("RefreshLeft"),j=d("el-tag"),J=d("el-pagination"),G=d("el-tabs"),Q=d("el-dialog"),q=be("loading");return V(),O("div",ve,[m("div",_e,[l[34]||(l[34]=m("h1",null,"系统设置",-1)),m("div",ye,[e(p,{type:"primary",onClick:t.saveSettings,loading:t.saving},{default:n(()=>[e(h,null,{default:n(()=>[e(T)]),_:1}),l[32]||(l[32]=c(" 保存设置 ",-1))]),_:1},8,["onClick","loading"]),e(p,{onClick:t.resetSettings},{default:n(()=>[e(h,null,{default:n(()=>[e(U)]),_:1}),l[33]||(l[33]=c(" 重置 ",-1))]),_:1},8,["onClick"])])]),e(G,{modelValue:t.activeTab,"onUpdate:modelValue":l[26]||(l[26]=a=>t.activeTab=a),type:"card",class:"settings-tabs"},{default:n(()=>[e(f,{label:"基础配置",name:"basic"},{default:n(()=>[e(D,{class:"settings-card"},{header:n(()=>[...l[35]||(l[35]=[m("div",{class:"card-header"},[m("span",null,"系统基础设置")],-1)])]),default:n(()=>[e(x,{model:t.basicSettings,"label-width":"150px",class:"settings-form"},{default:n(()=>[e(z,{gutter:20},{default:n(()=>[e(b,{span:12},{default:n(()=>[e(u,{label:"能耗单位设置"},{default:n(()=>[e(v,{modelValue:t.basicSettings.energyUnit,"onUpdate:modelValue":l[0]||(l[0]=a=>t.basicSettings.energyUnit=a),placeholder:"请选择默认能耗单位"},{default:n(()=>[e(i,{label:"千瓦时 (kWh)",value:"kWh"}),e(i,{label:"焦耳 (J)",value:"J"}),e(i,{label:"兆焦 (MJ)",value:"MJ"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"水量单位设置"},{default:n(()=>[e(v,{modelValue:t.basicSettings.waterUnit,"onUpdate:modelValue":l[1]||(l[1]=a=>t.basicSettings.waterUnit=a),placeholder:"请选择默认水量单位"},{default:n(()=>[e(i,{label:"立方米 (m³)",value:"m³"}),e(i,{label:"升 (L)",value:"L"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"燃气单位设置"},{default:n(()=>[e(v,{modelValue:t.basicSettings.gasUnit,"onUpdate:modelValue":l[2]||(l[2]=a=>t.basicSettings.gasUnit=a),placeholder:"请选择默认燃气单位"},{default:n(()=>[e(i,{label:"立方米 (m³)",value:"m³"}),e(i,{label:"升 (L)",value:"L"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"热力单位设置"},{default:n(()=>[e(v,{modelValue:t.basicSettings.heatUnit,"onUpdate:modelValue":l[3]||(l[3]=a=>t.basicSettings.heatUnit=a),placeholder:"请选择默认热力单位"},{default:n(()=>[e(i,{label:"吉焦 (GJ)",value:"GJ"}),e(i,{label:"兆瓦时 (MWh)",value:"MWh"}),e(i,{label:"百万千卡 (Gcal)",value:"Gcal"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:n(()=>[e(u,{label:"数据刷新频率"},{default:n(()=>[e(v,{modelValue:t.basicSettings.refreshRate,"onUpdate:modelValue":l[4]||(l[4]=a=>t.basicSettings.refreshRate=a),placeholder:"请选择数据刷新频率"},{default:n(()=>[e(i,{label:"5秒",value:"5"}),e(i,{label:"10秒",value:"10"}),e(i,{label:"30秒",value:"30"}),e(i,{label:"1分钟",value:"60"}),e(i,{label:"5分钟",value:"300"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"自动导出周期"},{default:n(()=>[e(v,{modelValue:t.basicSettings.exportCycle,"onUpdate:modelValue":l[5]||(l[5]=a=>t.basicSettings.exportCycle=a),placeholder:"请选择自动导出周期"},{default:n(()=>[e(i,{label:"每日",value:"daily"}),e(i,{label:"每周",value:"weekly"}),e(i,{label:"每月",value:"monthly"}),e(i,{label:"不自动导出",value:"none"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"数据保留期限"},{default:n(()=>[e(g,{modelValue:t.basicSettings.dataRetentionPeriod,"onUpdate:modelValue":l[6]||(l[6]=a=>t.basicSettings.dataRetentionPeriod=a),min:1,max:3650,step:1},null,8,["modelValue"]),l[36]||(l[36]=m("span",{class:"unit-label"},"天",-1))]),_:1}),e(u,{label:"系统主题"},{default:n(()=>[e(v,{modelValue:t.basicSettings.theme,"onUpdate:modelValue":l[7]||(l[7]=a=>t.basicSettings.theme=a),placeholder:"请选择系统主题"},{default:n(()=>[e(i,{label:"默认主题",value:"default"}),e(i,{label:"深色主题",value:"dark"}),e(i,{label:"浅色主题",value:"light"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{class:"settings-card",style:{"margin-top":"20px"}},{header:n(()=>[...l[37]||(l[37]=[m("div",{class:"card-header"},[m("span",null,"预警阈值设置")],-1)])]),default:n(()=>[e(x,{model:t.thresholdSettings,"label-width":"150px",class:"settings-form"},{default:n(()=>[e(z,{gutter:20},{default:n(()=>[e(b,{span:12},{default:n(()=>[e(u,{label:"电力预警阈值"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.electricityThreshold,"onUpdate:modelValue":l[8]||(l[8]=a=>t.thresholdSettings.electricityThreshold=a),min:0,max:1e4,step:1},null,8,["modelValue"]),l[38]||(l[38]=m("span",{class:"unit-label"},"kWh/h",-1))]),_:1}),e(u,{label:"水量预警阈值"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.waterThreshold,"onUpdate:modelValue":l[9]||(l[9]=a=>t.thresholdSettings.waterThreshold=a),min:0,max:1e3,step:.1},null,8,["modelValue"]),l[39]||(l[39]=m("span",{class:"unit-label"},"m³/h",-1))]),_:1}),e(u,{label:"燃气预警阈值"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.gasThreshold,"onUpdate:modelValue":l[10]||(l[10]=a=>t.thresholdSettings.gasThreshold=a),min:0,max:1e3,step:.1},null,8,["modelValue"]),l[40]||(l[40]=m("span",{class:"unit-label"},"m³/h",-1))]),_:1})]),_:1}),e(b,{span:12},{default:n(()=>[e(u,{label:"热力预警阈值"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.heatThreshold,"onUpdate:modelValue":l[11]||(l[11]=a=>t.thresholdSettings.heatThreshold=a),min:0,max:100,step:.1},null,8,["modelValue"]),l[41]||(l[41]=m("span",{class:"unit-label"},"GJ/h",-1))]),_:1}),e(u,{label:"设备离线时长"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.deviceOfflineDuration,"onUpdate:modelValue":l[12]||(l[12]=a=>t.thresholdSettings.deviceOfflineDuration=a),min:1,max:1440,step:1},null,8,["modelValue"]),l[42]||(l[42]=m("span",{class:"unit-label"},"分钟",-1))]),_:1}),e(u,{label:"数据波动阈值"},{default:n(()=>[e(g,{modelValue:t.thresholdSettings.dataFluctuationThreshold,"onUpdate:modelValue":l[13]||(l[13]=a=>t.thresholdSettings.dataFluctuationThreshold=a),min:0,max:100,step:1},null,8,["modelValue"]),l[43]||(l[43]=m("span",{class:"unit-label"},"%",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(f,{label:"权限管理",name:"permissions"},{default:n(()=>[m("div",Se,[m("div",Ve,[l[45]||(l[45]=m("h3",null,"角色管理",-1)),e(p,{type:"primary",onClick:t.showAddRoleDialog},{default:n(()=>[e(h,null,{default:n(()=>[e(E)]),_:1}),l[44]||(l[44]=c(" 新增角色 ",-1))]),_:1},8,["onClick"])]),e(A,{data:t.roles,style:{width:"100%"},border:"",class:"roles-table"},{default:n(()=>[e(r,{prop:"id",label:"角色ID",width:"100"}),e(r,{prop:"name",label:"角色名称",width:"150"}),e(r,{prop:"description",label:"角色描述","min-width":"200"}),e(r,{prop:"createdAt",label:"创建时间",width:"180"},{default:n(a=>[c(F(t.formatDateTime(a.row.createdAt)),1)]),_:1}),e(r,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(a=>[e(_,{modelValue:a.row.status,"onUpdate:modelValue":R=>a.row.status=R,"active-text":"启用","inactive-text":"禁用",onChange:R=>t.handleRoleStatusChange(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(r,{label:"操作",width:"150"},{default:n(a=>[e(p,{size:"small",type:"primary",onClick:R=>t.editRole(a.row)},{default:n(()=>[...l[46]||(l[46]=[c("编辑",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",type:"danger",onClick:R=>t.deleteRole(a.row)},{default:n(()=>[...l[47]||(l[47]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l[49]||(l[49]=m("div",{class:"section-header",style:{"margin-top":"30px"}},[m("h3",null,"菜单权限配置")],-1)),e(D,{class:"permissions-card"},{default:n(()=>[e(x,{model:t.permissionsForm,"label-width":"120px"},{default:n(()=>[e(u,{label:"选择角色"},{default:n(()=>[e(v,{modelValue:t.permissionsForm.roleId,"onUpdate:modelValue":l[14]||(l[14]=a=>t.permissionsForm.roleId=a),placeholder:"请选择角色"},{default:n(()=>[(V(!0),O(fe,null,he(t.roles,a=>(V(),K(i,{key:a.id,label:a.name,value:a.id,disabled:!a.status},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"菜单权限"},{default:n(()=>[t.permissionsForm.roleId?(V(),K(W,{key:0,ref:"menuTree",data:t.menuList,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":t.getCheckedMenuIds(t.permissionsForm.roleId),onCheckChange:t.handleMenuCheckChange},null,8,["data","default-checked-keys","onCheckChange"])):(V(),O("div",Le,"请先选择角色"))]),_:1}),e(u,null,{default:n(()=>[e(p,{type:"primary",onClick:t.saveRolePermissions,loading:t.savingPermissions},{default:n(()=>[e(h,null,{default:n(()=>[e(M)]),_:1}),l[48]||(l[48]=c(" 保存权限配置 ",-1))]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])]),_:1})])]),_:1}),e(f,{label:"日志管理",name:"logs"},{default:n(()=>[m("div",xe,[m("div",De,[e(G,{modelValue:t.activeLogTab,"onUpdate:modelValue":l[25]||(l[25]=a=>t.activeLogTab=a),type:"border-card"},{default:n(()=>[e(f,{label:"操作日志",name:"operation"},{default:n(()=>[m("div",ke,[e(v,{modelValue:t.operationLogFilter.type,"onUpdate:modelValue":l[15]||(l[15]=a=>t.operationLogFilter.type=a),placeholder:"操作类型",clearable:"",style:{width:"150px","margin-right":"15px"}},{default:n(()=>[e(i,{label:"登录",value:"login"}),e(i,{label:"登出",value:"logout"}),e(i,{label:"创建",value:"create"}),e(i,{label:"更新",value:"update"}),e(i,{label:"删除",value:"delete"}),e(i,{label:"查询",value:"query"})]),_:1},8,["modelValue"]),e(C,{modelValue:t.operationLogFilter.username,"onUpdate:modelValue":l[16]||(l[16]=a=>t.operationLogFilter.username=a),placeholder:"用户名",clearable:"",style:{width:"150px","margin-right":"15px"}},null,8,["modelValue"]),e(B,{modelValue:t.operationLogFilter.dateRange,"onUpdate:modelValue":l[17]||(l[17]=a=>t.operationLogFilter.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"280px","margin-right":"15px"}},null,8,["modelValue"]),e(p,{type:"primary",onClick:t.searchOperationLogs},{default:n(()=>[e(h,null,{default:n(()=>[e(N)]),_:1}),l[50]||(l[50]=c(" 搜索 ",-1))]),_:1},8,["onClick"]),e(p,{onClick:t.resetOperationLogFilters},{default:n(()=>[e(h,null,{default:n(()=>[e(H)]),_:1}),l[51]||(l[51]=c(" 重置 ",-1))]),_:1},8,["onClick"])]),ee((V(),K(A,{data:t.filteredOperationLogs,style:{width:"100%"},border:""},{default:n(()=>[e(r,{prop:"id",label:"ID",width:"80"}),e(r,{prop:"username",label:"用户名",width:"120"}),e(r,{prop:"type",label:"操作类型",width:"100"},{default:n(a=>[e(j,{type:t.getOperationTypeTag(a.row.type)},{default:n(()=>[c(F(t.getOperationTypeText(a.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"action",label:"操作内容","min-width":"250"}),e(r,{prop:"ip",label:"IP地址",width:"150"}),e(r,{prop:"userAgent",label:"浏览器信息","min-width":"200"}),e(r,{prop:"createdAt",label:"操作时间",width:"180",align:"center"},{default:n(a=>[c(F(t.formatDateTime(a.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[q,t.loadingLogs]]),t.filteredOperationLogs.length>0?(V(),O("div",Te,[e(J,{"current-page":t.operationLogPage.current,"onUpdate:currentPage":l[18]||(l[18]=a=>t.operationLogPage.current=a),"page-size":t.operationLogPage.size,"onUpdate:pageSize":l[19]||(l[19]=a=>t.operationLogPage.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.filteredOperationLogs.length},null,8,["current-page","page-size","total"])])):le("",!0)]),_:1}),e(f,{label:"登录日志",name:"login"},{default:n(()=>[m("div",Ue,[e(C,{modelValue:t.loginLogFilter.username,"onUpdate:modelValue":l[20]||(l[20]=a=>t.loginLogFilter.username=a),placeholder:"用户名",clearable:"",style:{width:"150px","margin-right":"15px"}},null,8,["modelValue"]),e(v,{modelValue:t.loginLogFilter.status,"onUpdate:modelValue":l[21]||(l[21]=a=>t.loginLogFilter.status=a),placeholder:"登录状态",clearable:"",style:{width:"120px","margin-right":"15px"}},{default:n(()=>[e(i,{label:"成功",value:"success"}),e(i,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),e(B,{modelValue:t.loginLogFilter.dateRange,"onUpdate:modelValue":l[22]||(l[22]=a=>t.loginLogFilter.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"280px","margin-right":"15px"}},null,8,["modelValue"]),e(p,{type:"primary",onClick:t.searchLoginLogs},{default:n(()=>[e(h,null,{default:n(()=>[e(N)]),_:1}),l[52]||(l[52]=c(" 搜索 ",-1))]),_:1},8,["onClick"]),e(p,{onClick:t.resetLoginLogFilters},{default:n(()=>[e(h,null,{default:n(()=>[e(U)]),_:1}),l[53]||(l[53]=c(" 重置 ",-1))]),_:1},8,["onClick"])]),ee((V(),K(A,{data:t.filteredLoginLogs,style:{width:"100%"},border:""},{default:n(()=>[e(r,{prop:"id",label:"ID",width:"80"}),e(r,{prop:"username",label:"用户名",width:"120"}),e(r,{prop:"status",label:"登录状态",width:"100",align:"center"},{default:n(a=>[e(j,{type:a.row.status==="success"?"success":"danger"},{default:n(()=>[c(F(a.row.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"message",label:"登录信息","min-width":"250"}),e(r,{prop:"ip",label:"IP地址",width:"150"}),e(r,{prop:"location",label:"登录地点",width:"150"}),e(r,{prop:"browser",label:"浏览器","min-width":"180"}),e(r,{prop:"createdAt",label:"登录时间",width:"180",align:"center"},{default:n(a=>[c(F(t.formatDateTime(a.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[q,t.loadingLogs]]),t.filteredLoginLogs.length>0?(V(),O("div",Ce,[e(J,{"current-page":t.loginLogPage.current,"onUpdate:currentPage":l[23]||(l[23]=a=>t.loginLogPage.current=a),"page-size":t.loginLogPage.size,"onUpdate:pageSize":l[24]||(l[24]=a=>t.loginLogPage.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.filteredLoginLogs.length},null,8,["current-page","page-size","total"])])):le("",!0)]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"]),e(Q,{modelValue:t.roleDialogVisible,"onUpdate:modelValue":l[31]||(l[31]=a=>t.roleDialogVisible=a),title:t.editingRole?"编辑角色":"新增角色",width:"500px"},{footer:n(()=>[m("span",Re,[e(p,{onClick:l[30]||(l[30]=a=>t.roleDialogVisible=!1)},{default:n(()=>[...l[54]||(l[54]=[c("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:t.saveRole,loading:t.savingRole},{default:n(()=>[c(F(t.editingRole?"更新":"创建"),1)]),_:1},8,["onClick","loading"])])]),default:n(()=>[e(x,{model:t.roleForm,"label-width":"100px",rules:t.roleRules,ref:"roleFormRef"},{default:n(()=>[e(u,{label:"角色名称",prop:"name"},{default:n(()=>[e(C,{modelValue:t.roleForm.name,"onUpdate:modelValue":l[27]||(l[27]=a=>t.roleForm.name=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"角色描述",prop:"description"},{default:n(()=>[e(C,{modelValue:t.roleForm.description,"onUpdate:modelValue":l[28]||(l[28]=a=>t.roleForm.description=a),placeholder:"请输入角色描述",type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(u,{label:"角色状态"},{default:n(()=>[e(_,{modelValue:t.roleForm.status,"onUpdate:modelValue":l[29]||(l[29]=a=>t.roleForm.status=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}const Oe=re(we,[["render",Fe],["__scopeId","data-v-af960045"]]);export{Oe as default};
