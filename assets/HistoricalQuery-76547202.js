import{_ as Z,z as K,y as X,J as $,r as q,f as F,k as ee,g as r,O as te,o as d,c as B,a as o,h as e,i as a,E as ae,F as L,q as H,j as f,t as u,n as V,p as g,N as Q,w as le}from"./index-45cd1a9a.js";const ne={name:"HistoricalQuery",components:{ArrowDown:K,ArrowUp:X,Minus:$},setup(){const C=q(!1),l=F({dateRange:[new Date(new Date().setDate(new Date().getDate()-30)),new Date],timeGranularity:"day",energyType:["electricity","water","gas","heat"],zoneId:"all",enterpriseId:"all",isQualified:"all"}),w=F({currentPage:1,pageSize:20,total:100}),t=F([{id:"a",name:"A栋"},{id:"b",name:"B栋"},{id:"c",name:"C栋"},{id:"d",name:"D栋"},{id:"parking",name:"停车场"}]),x=F([{id:1,name:"科技有限公司"},{id:2,name:"智慧园区管理处"},{id:3,name:"绿色能源公司"},{id:4,name:"物业服务公司"}]),U=q([]),E=F({electricity:256800,water:4250,gas:1850,heat:650,electricityChange:3.2,waterChange:-1.5,gasChange:2.8,heatChange:.9}),h=i=>i==null?"--":Number(i).toFixed(2),m=()=>{C.value=!0,setTimeout(()=>{y(),C.value=!1},1e3)},s=()=>{l.dateRange=[new Date(new Date().setDate(new Date().getDate()-30)),new Date],l.timeGranularity="day",l.energyType=["electricity","water","gas","heat"],l.zoneId="all",l.enterpriseId="all",l.isQualified="all",w.currentPage=1,m()},b=i=>{C.value=!0,setTimeout(()=>{C.value=!1,ae.success(`${i==="excel"?"Excel":"PDF"} 文件导出成功`)},1500)},N=i=>{w.pageSize=i,m()},k=i=>{w.currentPage=i,m()},y=()=>{const i=[],M=l.dateRange[0],P=l.dateRange[1],z=Math.ceil((P-M)/(1e3*60*60*24));let D=z;l.timeGranularity==="week"?D=Math.ceil(z/7):l.timeGranularity==="month"&&(D=Math.ceil(z/30));const p=w.pageSize,v=(w.currentPage-1)*p;for(let c=0;c<p&&v+c<D;c++){const S=v+c,_=new Date(M);l.timeGranularity==="day"?_.setDate(_.getDate()+S):l.timeGranularity==="week"?_.setDate(_.getDate()+S*7):l.timeGranularity==="month"&&_.setMonth(_.getMonth()+S);const G=t[Math.floor(Math.random()*t.length)],R=x[Math.floor(Math.random()*x.length)],A=8e3+Math.random()*4e3,n=100+Math.random()*50,J=50+Math.random()*30,j=20+Math.random()*10,O=(Math.random()-.5)*10,Y=Math.random()>.1;let I="";if(l.timeGranularity==="day")I=_.toLocaleDateString("zh-CN");else if(l.timeGranularity==="week"){const W=new Date(_),T=new Date(_);T.setDate(T.getDate()+6),I=`${W.toLocaleDateString("zh-CN")} 至 ${T.toLocaleDateString("zh-CN")}`}else l.timeGranularity==="month"&&(I=`${_.getFullYear()}年${_.getMonth()+1}月`);i.push({id:`${S+1}`,date:I,zoneId:G.id,zoneName:G.name,enterpriseId:R.id,enterpriseName:R.name,electricity:A,water:n,gas:J,heat:j,changeRate:O,isQualified:Y,notes:Y?"":"能耗超标，需要优化"})}U.value=i,w.total=D};return ee(()=>{m()}),{loading:C,filterForm:l,pagination:w,zones:t,enterprises:x,energyData:U,totalStatistics:E,formatNumber:h,queryData:m,resetFilter:s,handleExport:b,handleSizeChange:N,handleCurrentChange:k}}},oe={class:"historical-query"},ie={class:"stats-cards"},re={class:"stat-content"},se={class:"stat-value"},de={class:"stat-content"},ce={class:"stat-value"},ue={class:"stat-content"},ge={class:"stat-value"},me={class:"stat-content"},_e={class:"stat-value"},fe={class:"card-header"},he={class:"total-count"},pe={class:"pagination-container"};function we(C,l,w,t,x,U){const E=r("el-date-picker"),h=r("el-form-item"),m=r("el-col"),s=r("el-option"),b=r("el-select"),N=r("el-row"),k=r("el-button"),y=r("ArrowDown"),i=r("el-icon"),M=r("el-dropdown-item"),P=r("el-dropdown-menu"),z=r("el-dropdown"),D=r("el-form"),p=r("el-card"),v=r("ArrowUp"),c=r("el-table-column"),S=r("Minus"),_=r("el-tag"),G=r("el-table"),R=r("el-pagination"),A=te("loading");return d(),B("div",oe,[l[18]||(l[18]=o("div",{class:"page-header"},[o("h1",null,"历史能耗查询")],-1)),e(p,{class:"filter-card"},{default:a(()=>[e(D,{model:t.filterForm,"label-width":"100px"},{default:a(()=>[e(N,{gutter:20},{default:a(()=>[e(m,{span:6},{default:a(()=>[e(h,{label:"时间范围"},{default:a(()=>[e(E,{modelValue:t.filterForm.dateRange,"onUpdate:modelValue":l[0]||(l[0]=n=>t.filterForm.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:a(()=>[e(h,{label:"时间粒度"},{default:a(()=>[e(b,{modelValue:t.filterForm.timeGranularity,"onUpdate:modelValue":l[1]||(l[1]=n=>t.filterForm.timeGranularity=n),placeholder:"选择时间粒度"},{default:a(()=>[e(s,{label:"按日",value:"day"}),e(s,{label:"按周",value:"week"}),e(s,{label:"按月",value:"month"}),e(s,{label:"按年",value:"year"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:a(()=>[e(h,{label:"能源类型"},{default:a(()=>[e(b,{modelValue:t.filterForm.energyType,"onUpdate:modelValue":l[2]||(l[2]=n=>t.filterForm.energyType=n),placeholder:"选择能源类型",multiple:"","collapse-tags":""},{default:a(()=>[e(s,{label:"电力",value:"electricity"}),e(s,{label:"水",value:"water"}),e(s,{label:"燃气",value:"gas"}),e(s,{label:"热力",value:"heat"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:a(()=>[e(h,{label:"区域/楼栋"},{default:a(()=>[e(b,{modelValue:t.filterForm.zoneId,"onUpdate:modelValue":l[3]||(l[3]=n=>t.filterForm.zoneId=n),placeholder:"选择区域"},{default:a(()=>[e(s,{label:"全部区域",value:"all"}),(d(!0),B(L,null,H(t.zones,n=>(d(),g(s,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:20,style:{"margin-top":"10px"}},{default:a(()=>[e(m,{span:6},{default:a(()=>[e(h,{label:"企业名称"},{default:a(()=>[e(b,{modelValue:t.filterForm.enterpriseId,"onUpdate:modelValue":l[4]||(l[4]=n=>t.filterForm.enterpriseId=n),placeholder:"选择企业"},{default:a(()=>[e(s,{label:"全部企业",value:"all"}),(d(!0),B(L,null,H(t.enterprises,n=>(d(),g(s,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:a(()=>[e(h,{label:"是否达标"},{default:a(()=>[e(b,{modelValue:t.filterForm.isQualified,"onUpdate:modelValue":l[5]||(l[5]=n=>t.filterForm.isQualified=n),placeholder:"是否达标"},{default:a(()=>[e(s,{label:"全部",value:"all"}),e(s,{label:"达标",value:"true"}),e(s,{label:"不达标",value:"false"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12,style:{"text-align":"right"}},{default:a(()=>[e(h,null,{default:a(()=>[e(k,{type:"primary",onClick:t.queryData},{default:a(()=>[...l[8]||(l[8]=[f("查询",-1)])]),_:1},8,["onClick"]),e(k,{onClick:t.resetFilter},{default:a(()=>[...l[9]||(l[9]=[f("重置",-1)])]),_:1},8,["onClick"]),e(z,{onCommand:t.handleExport},{dropdown:a(()=>[e(P,null,{default:a(()=>[e(M,{command:"excel"},{default:a(()=>[...l[11]||(l[11]=[f("导出Excel",-1)])]),_:1}),e(M,{command:"pdf"},{default:a(()=>[...l[12]||(l[12]=[f("导出PDF",-1)])]),_:1})]),_:1})]),default:a(()=>[e(k,{type:"default"},{default:a(()=>[l[10]||(l[10]=f(" 导出 ",-1)),e(i,{class:"el-icon--right"},{default:a(()=>[e(y)]),_:1})]),_:1})]),_:1},8,["onCommand"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o("div",ie,[e(p,{class:"stat-card"},{default:a(()=>[o("div",re,[l[13]||(l[13]=o("div",{class:"stat-label"},"总用电量",-1)),o("div",se,u(t.totalStatistics.electricity)+" kWh",1),o("div",{class:V(["stat-change",{positive:t.totalStatistics.electricityChange>0,negative:t.totalStatistics.electricityChange<0}])},[t.totalStatistics.electricityChange>0?(d(),g(i,{key:0},{default:a(()=>[e(v)]),_:1})):t.totalStatistics.electricityChange<0?(d(),g(i,{key:1},{default:a(()=>[e(y)]),_:1})):Q("",!0),f(" "+u(Math.abs(t.totalStatistics.electricityChange))+"% ",1)],2)])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[o("div",de,[l[14]||(l[14]=o("div",{class:"stat-label"},"总用水量",-1)),o("div",ce,u(t.totalStatistics.water)+" m³",1),o("div",{class:V(["stat-change",{positive:t.totalStatistics.waterChange>0,negative:t.totalStatistics.waterChange<0}])},[t.totalStatistics.waterChange>0?(d(),g(i,{key:0},{default:a(()=>[e(v)]),_:1})):t.totalStatistics.waterChange<0?(d(),g(i,{key:1},{default:a(()=>[e(y)]),_:1})):Q("",!0),f(" "+u(Math.abs(t.totalStatistics.waterChange))+"% ",1)],2)])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[o("div",ue,[l[15]||(l[15]=o("div",{class:"stat-label"},"总用气量",-1)),o("div",ge,u(t.totalStatistics.gas)+" m³",1),o("div",{class:V(["stat-change",{positive:t.totalStatistics.gasChange>0,negative:t.totalStatistics.gasChange<0}])},[t.totalStatistics.gasChange>0?(d(),g(i,{key:0},{default:a(()=>[e(v)]),_:1})):t.totalStatistics.gasChange<0?(d(),g(i,{key:1},{default:a(()=>[e(y)]),_:1})):Q("",!0),f(" "+u(Math.abs(t.totalStatistics.gasChange))+"% ",1)],2)])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[o("div",me,[l[16]||(l[16]=o("div",{class:"stat-label"},"总用热量",-1)),o("div",_e,u(t.totalStatistics.heat)+" GJ",1),o("div",{class:V(["stat-change",{positive:t.totalStatistics.heatChange>0,negative:t.totalStatistics.heatChange<0}])},[t.totalStatistics.heatChange>0?(d(),g(i,{key:0},{default:a(()=>[e(v)]),_:1})):t.totalStatistics.heatChange<0?(d(),g(i,{key:1},{default:a(()=>[e(y)]),_:1})):Q("",!0),f(" "+u(Math.abs(t.totalStatistics.heatChange))+"% ",1)],2)])]),_:1})]),e(p,{class:"data-table-card"},{header:a(()=>[o("div",fe,[l[17]||(l[17]=o("span",null,"能耗数据列表",-1)),o("span",he,"共 "+u(t.energyData.length)+" 条数据",1)])]),default:a(()=>[le((d(),g(G,{data:t.energyData,style:{width:"100%"},border:""},{default:a(()=>[e(c,{prop:"date",label:"日期",width:"180"}),e(c,{prop:"zoneName",label:"区域/楼栋",width:"120"}),e(c,{prop:"enterpriseName",label:"企业名称",width:"150"}),e(c,{prop:"electricity",label:"用电量(kWh)",width:"120",align:"right"},{default:a(n=>[o("span",null,u(t.formatNumber(n.row.electricity)),1)]),_:1}),e(c,{prop:"water",label:"用水量(m³)",width:"120",align:"right"},{default:a(n=>[o("span",null,u(t.formatNumber(n.row.water)),1)]),_:1}),e(c,{prop:"gas",label:"用气量(m³)",width:"120",align:"right"},{default:a(n=>[o("span",null,u(t.formatNumber(n.row.gas)),1)]),_:1}),e(c,{prop:"heat",label:"用热量(GJ)",width:"120",align:"right"},{default:a(n=>[o("span",null,u(t.formatNumber(n.row.heat)),1)]),_:1}),e(c,{prop:"changeRate",label:"环比变化",width:"120",align:"right"},{default:a(n=>[o("span",{class:V({positive:n.row.changeRate>0,negative:n.row.changeRate<0})},[n.row.changeRate>0?(d(),g(i,{key:0},{default:a(()=>[e(v)]),_:1})):n.row.changeRate<0?(d(),g(i,{key:1},{default:a(()=>[e(y)]),_:1})):(d(),g(i,{key:2},{default:a(()=>[e(S)]),_:1})),f(" "+u(Math.abs(n.row.changeRate))+"% ",1)],2)]),_:1}),e(c,{prop:"isQualified",label:"是否达标",width:"100",align:"center"},{default:a(n=>[e(_,{type:n.row.isQualified?"success":"danger"},{default:a(()=>[f(u(n.row.isQualified?"达标":"不达标"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"notes",label:"备注","min-width":"150"})]),_:1},8,["data"])),[[A,t.loading]]),o("div",pe,[e(R,{"current-page":t.pagination.currentPage,"onUpdate:currentPage":l[6]||(l[6]=n=>t.pagination.currentPage=n),"page-size":t.pagination.pageSize,"onUpdate:pageSize":l[7]||(l[7]=n=>t.pagination.pageSize=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),_:1})])}const ve=Z(ne,[["render",we],["__scopeId","data-v-0401713f"]]);export{ve as default};
